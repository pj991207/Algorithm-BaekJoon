SELECT A.CAR_ID AS CAR_ID, A.CAR_TYPE AS CAR_TYPE, FLOOR(A.DAILY_FEE*30*(100-C.DISCOUNT_RATE)*0.01) AS FEE
FROM CAR_RENTAL_COMPANY_CAR AS A, CAR_RENTAL_COMPANY_RENTAL_HISTORY AS B, CAR_RENTAL_COMPANY_DISCOUNT_PLAN AS C
WHERE A.CAR_ID = B.CAR_ID AND A.CAR_TYPE = C.CAR_TYPE AND A.CAR_ID NOT IN 
(SELECT CAR_ID FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY AS B 
 WHERE ((B.START_DATE BETWEEN "2022-11-01" AND "2022-11-30") AND (B.END_DATE BETWEEN "2022-11-01" AND "2022-11-30"))
 OR ((B.START_DATE < "2022-11-01" AND (B.END_DATE BETWEEN "2022-11-01" AND "2022-11-30")))
 OR ((B.END_DATE > "2022-11-30" AND (B.START_DATE BETWEEN "2022-11-01" AND "2022-11-30")))
 OR ((B.START_DATE<"2022-11-01")AND(B.END_DATE>"2022-11-30"))
 )
AND A.CAR_TYPE IN ("세단","SUV") AND  C.DURATION_TYPE = "30일 이상" AND  FLOOR(A.DAILY_FEE*30*(100-C.DISCOUNT_RATE)*0.01) >= 500000 AND  FLOOR(A.DAILY_FEE*30*(100-C.DISCOUNT_RATE)*0.01) <2000000
GROUP BY CAR_ID,CAR_TYPE
ORDER BY FEE DESC, CAR_TYPE,CAR_ID;
